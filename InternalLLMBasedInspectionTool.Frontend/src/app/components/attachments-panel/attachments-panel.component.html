<div class="attachments-panel" [class.collapsed]="isCollapsed">
    <button class="panel-header" (click)="toggleCollapse()">
        <span class="panel-title">Files</span>
        <div class="chevron-icon" [innerHTML]="chevronIcon"></div>
    </button>

    @if (!isCollapsed) {
        <div class="panel-content">
            @if (attachments().length === 0) {
                <div class="empty-state">
                    <p class="empty-text">No files uploaded</p>
                </div>
            } @else {
                <div class="attachments-list">
                    @for (attachment of attachments(); track attachment.id) {
                        <div
                            class="attachment-item"
                            [class.hovered]="
                                hoveredAttachmentId === attachment.id
                            "
                            [class.active]="
                                currentAttachmentId() === attachment.id
                            "
                            (click)="onAttachmentClick(attachment)"
                            (mouseenter)="onItemMouseEnter(attachment.id)"
                            (mouseleave)="onItemMouseLeave()"
                        >
                            <span class="attachment-name">{{
                                attachment.name
                            }}</span>
                            <div class="kebab-menu-container" [class.menu-open]="isMenuOpen(attachment.id)">
                                <button
                                    class="kebab-menu-button"
                                    [class.visible]="
                                        hoveredAttachmentId === attachment.id || isMenuOpen(attachment.id)
                                    "
                                    aria-label="Menu"
                                    (click)="onKebabMenuClick($event, attachment)"
                                >
                                    <div [innerHTML]="kebabMenuIcon"></div>
                                </button>
                                @if (isMenuOpen(attachment.id)) {
                                    <div class="dropdown-menu">
                                        <button
                                            class="menu-item"
                                            (click)="onDownloadClick($event, attachment)"
                                        >
                                            <span class="menu-item-text">Download</span>
                                        </button>
                                        <button
                                            class="menu-item menu-item-danger"
                                            (click)="onRemoveClick($event, attachment)"
                                        >
                                            <span class="menu-item-text">Remove</span>
                                        </button>
                                    </div>
                                }
                            </div>
                        </div>
                    }
                </div>
            }
        </div>
    }
</div>
